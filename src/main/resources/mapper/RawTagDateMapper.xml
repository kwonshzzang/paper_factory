<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.re.etri.batis.mapper.RawTagDateMapper">
  <resultMap id="BaseResultMap" type="kr.re.etri.batis.domain.RawTagDate">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 10:51:28 KST 2022.
    -->
    <id column="measure_date" jdbcType="TIMESTAMP" property="measureDate" />
    <id column="tag_id" jdbcType="VARCHAR" property="tagId" />
    <result column="value" jdbcType="DECIMAL" property="value" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 10:51:28 KST 2022.
    -->
    delete from raw_tag_data
    where measure_date = #{measureDate,jdbcType=TIMESTAMP}
      and tag_id = #{tagId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="kr.re.etri.batis.domain.RawTagDate">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 10:51:28 KST 2022.
    -->
    insert into raw_tag_data (measure_date, tag_id, value
      )
    values (#{measureDate,jdbcType=TIMESTAMP}, #{tagId,jdbcType=VARCHAR}, #{value,jdbcType=DECIMAL}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="kr.re.etri.batis.domain.RawTagDate">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 10:51:28 KST 2022.
    -->
    update raw_tag_data
    set value = #{value,jdbcType=DECIMAL}
    where measure_date = #{measureDate,jdbcType=TIMESTAMP}
      and tag_id = #{tagId,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 10:51:28 KST 2022.
    -->
    select measure_date, tag_id, value
    from raw_tag_data
    where measure_date = #{measureDate,jdbcType=TIMESTAMP}
      and tag_id = #{tagId,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 20 10:51:28 KST 2022.
    -->
    select measure_date, tag_id, value
    from raw_tag_data
  </select>
  
  <select id="selectTodayAll" parameterType="map" resultMap="BaseResultMap">
    select measure_date, tag_id, value
    from raw_tag_data
    where date(measure_date) = #{measureDate,jdbcType=VARCHAR}
      and tag_id = #{tagId,jdbcType=VARCHAR}
  </select>
  
  <select id="selectPerTime" parameterType="map" resultType="HashMap">
    select FROM_UNIXTIME(FLOOR(UNIX_TIMESTAMP(measure_date) / (#{tagMinute,jdbcType=INTEGER}*60))
                      * (#{tagMinute,jdbcType=INTEGER}*60)) as tagDate, sum(value) as tagValue from raw_tag_data 
                      where tag_id = #{tagId,jdbcType=VARCHAR} and 
                      measure_date between #{tagFrom,jdbcType=VARCHAR} and #{tagTo,jdbcType=VARCHAR} group by tagDate
  </select>
  
  <select id="selectNowData" parameterType="map" resultMap="BaseResultMap">
  	<![CDATA[
    select measure_date, tag_id, value
    FROM paper_dt.raw_tag_data
	WHERE measure_date <= now() and tag_id = #{tagId,jdbcType=VARCHAR}
	ORDER BY measure_date DESC
	LIMIT 1
	]]>
  </select>
  
  <select id="selectTodayBetween15" parameterType="map" resultMap="BaseResultMap">
    select measure_date, tag_id, value
    from raw_tag_data
    WHERE measure_date BETWEEN CONCAT(CURDATE(), " ", "00:00:00") AND now()
	 AND tag_id = #{tagId,jdbcType=VARCHAR}
	 AND DATE_FORMAT(measure_date, '%i') in('00', '15', '30', '45')   
  </select>
  
  <select id="selectYesterdayBetween15" parameterType="map" resultMap="BaseResultMap">
    select measure_date, tag_id, value
    from raw_tag_data
    WHERE measure_date BETWEEN CONCAT((CURDATE() - INTERVAL 1 DAY), " ", "00:00:00") AND CONCAT((CURDATE() - INTERVAL 1 DAY), " ", CURTIME())
	 AND tag_id = #{tagId,jdbcType=VARCHAR}
	 AND DATE_FORMAT(measure_date, '%i') in('00', '15', '30', '45')   
  </select>
  
  <select id="selectTodayBetween15Total" resultMap="BaseResultMap">
    select measure_date, sum(value) as value
    from raw_tag_data
    WHERE measure_date BETWEEN CONCAT(CURDATE(), " ", "00:00:00") AND now()
	 AND (tag_id = 'HFEMS.MRPAP.01.SH02.PM001.01.KW' or tag_id = 'HFEMS.MRPAP.01.SH02.PM001.02.KW' or tag_id = 'HFEMS.MRPAP.01.SH02.PM001.03.KW')
	 AND DATE_FORMAT(measure_date, '%i') in('00', '15', '30', '45')   
	 group by measure_date
  </select>
  
  <select id="selectYesterdayBetween15Total" resultMap="BaseResultMap">
    select measure_date, sum(value) as value
    from raw_tag_data
    WHERE measure_date BETWEEN CONCAT((CURDATE() - INTERVAL 1 DAY), " ", "00:00:00") AND CONCAT((CURDATE() - INTERVAL 1 DAY), " ", CURTIME())
	 AND (tag_id = 'HFEMS.MRPAP.01.SH02.PM001.01.KW' or tag_id = 'HFEMS.MRPAP.01.SH02.PM001.02.KW' or tag_id = 'HFEMS.MRPAP.01.SH02.PM001.03.KW')
	 AND DATE_FORMAT(measure_date, '%i') in('00', '15', '30', '45')   
	 group by measure_date
  </select>
  
  
  
  <select id="selectPerDay" parameterType="map" resultType="HashMap">
	SELECT DATE_FORMAT( measure_date, '%Y-%m-%d') as regdate, MIN(value) as minval, MAX(value) as maxval, AVG(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND tag_id = #{tagId,jdbcType=VARCHAR}
	GROUP BY regdate
  </select>
  
  
  <select id="selectPerWeek" parameterType="map" resultType="HashMap">
    SELECT DATE_FORMAT(measure_date, '%U') as regdate, min(value) as minval, max(value) as maxval, avg(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND tag_id = #{tagId,jdbcType=VARCHAR}
	GROUP BY regdate 
  </select>
  
  
  <select id="selectPerMonth" parameterType="map" resultType="HashMap">
    SELECT DATE_FORMAT(measure_date, '%Y-%m') as regdate, min(value) as minval, max(value) as maxval, avg(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND tag_id = #{tagId,jdbcType=VARCHAR}
	GROUP BY regdate 
  </select>
  
  
  <select id="selectPerYear" parameterType="map" resultType="HashMap">
    SELECT DATE_FORMAT(measure_date, '%Y') as regdate, min(value) as minval, max(value) as maxval, avg(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND tag_id = #{tagId,jdbcType=VARCHAR}
	GROUP BY regdate 
  </select>
  
  
  <select id="selectTotalPerDay" parameterType="map" resultType="HashMap">
	SELECT DATE_FORMAT( measure_date, '%Y-%m-%d') as regdate, MIN(value) as minval, MAX(value) as maxval, AVG(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND (tag_id = #{tagId1,jdbcType=VARCHAR} OR tag_id = #{tagId2,jdbcType=VARCHAR} OR tag_id = #{tagId3,jdbcType=VARCHAR})
	GROUP BY regdate
  </select>
  
  
  <select id="selectTotalPerWeek" parameterType="map" resultType="HashMap">
    SELECT DATE_FORMAT(measure_date, '%U') as regdate, min(value) as minval, max(value) as maxval, avg(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND (tag_id = #{tagId1,jdbcType=VARCHAR} OR tag_id = #{tagId2,jdbcType=VARCHAR} OR tag_id = #{tagId3,jdbcType=VARCHAR})
	GROUP BY regdate 
  </select>
  
  
  <select id="selectTotalPerMonth" parameterType="map" resultType="HashMap">
    SELECT DATE_FORMAT(measure_date, '%Y-%m') as regdate, min(value) as minval, max(value) as maxval, avg(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND (tag_id = #{tagId1,jdbcType=VARCHAR} OR tag_id = #{tagId2,jdbcType=VARCHAR} OR tag_id = #{tagId3,jdbcType=VARCHAR})
	GROUP BY regdate 
  </select>
  
  
  <select id="selectTotalPerYear" parameterType="map" resultType="HashMap">
    SELECT DATE_FORMAT(measure_date, '%Y') as regdate, min(value) as minval, max(value) as maxval, avg(value) as avgval
	FROM paper_dt.raw_tag_data
	WHERE measure_date BETWEEN #{tagFrom,jdbcType=VARCHAR} AND #{tagTo,jdbcType=VARCHAR}
	AND (tag_id = #{tagId1,jdbcType=VARCHAR} OR tag_id = #{tagId2,jdbcType=VARCHAR} OR tag_id = #{tagId3,jdbcType=VARCHAR})
	GROUP BY regdate 
  </select>
</mapper>